FROM node:22-bullseye-slim

WORKDIR /app

# Install SvelteKit CLI globally
RUN npm install -g @sveltejs/kit

# Copy root package files and all workspace package.jsons
COPY package.json package-lock.json ./
COPY packages/schedx-app/package.json ./packages/schedx-app/
COPY packages/schedx-shared-lib/package.json ./packages/schedx-shared-lib/
COPY packages/schedx-scheduler/package.json ./packages/schedx-scheduler/

# Install all dependencies (for all workspaces)
RUN npm install

# Copy all source files
COPY . .

# Install any missing dependencies
RUN npm install

# Build shared-lib first (dependency for others)
RUN npm run build --workspace=@schedx/shared-lib

# Expose the default SvelteKit port
EXPOSE 5173

# Default command (will be overridden by docker-compose.dev.yml)
CMD ["npm", "run", "dev", "--workspace=@schedx/app"] 