# Preline UI â†’ shadcn-svelte Migration Plan

This document outlines a comprehensive plan for migrating SchedX from Preline UI to shadcn-svelte.

## Executive Summary

| Metric | Value |
|--------|-------|
| **Estimated Effort** | 2-3 days (full-time) |
| **Files Affected** | ~50+ files |
| **Risk Level** | Low-Medium |
| **Breaking Changes** | Theme system simplified to light/dark |

---

## Current State Analysis

### Preline Dependencies

| File | Preline Usage |
|------|---------------|
| `app.html` | Loads `preline.css` and `preline.js` |
| `app.css` | Imports `preline/variants.css`, 1200+ lines of theme overrides |
| `app.d.ts` | TypeScript declarations for `HSStaticMethods`, `HSThemeSwitch`, `HSFileUpload` |
| `tailwind.config.js` | References `preline/dist/*.js` in content array |
| `+layout.svelte` | Calls `HSStaticMethods.autoInit()` on mount |

### Preline Components in Use

| Component | Files Using | shadcn Equivalent |
|-----------|-------------|-------------------|
| **HSStaticMethods.autoInit()** | 13 pages | Not needed (Svelte components) |
| **hs-accordion** | `Sidebar.svelte` | `Accordion` |
| **hs-tooltip** | `PerformanceTrends.svelte` | `Tooltip` |
| **hs-overlay** | `scheduled/+page.svelte` | `Dialog` / `Sheet` |
| **hs-datepicker** | CSS overrides only | `Calendar` + `Popover` |
| **hs-file-upload** | `FileUpload.svelte` | Custom (keep existing) |
| **hs-textarea-auto-height** | CSS overrides only | `Textarea` with autosize |
| **data-hs-theme-*** | `ThemeToggle.svelte` | shadcn `mode-watcher` |

### Theme System

**Current:** 3 custom themes (light, dark/dim, lightsout)
**After Migration:** Standard shadcn light/dark using `mode-watcher`

This simplification removes ~800 lines of custom CSS overrides.

---

## Migration Strategy

### Phase 1: Foundation (Day 1)

#### 1.1 Install shadcn-svelte

```bash
cd packages/schedx-app
npx shadcn-svelte@latest init
```

Configuration choices:
- Style: **Default**
- Base color: **Slate** (closest to current)
- CSS variables: **Yes**
- Tailwind config location: `tailwind.config.js`
- Components location: `$lib/components/ui`
- Utils location: `$lib/utils`

#### 1.2 Install Core Components

```bash
npx shadcn-svelte@latest add button
npx shadcn-svelte@latest add card
npx shadcn-svelte@latest add input
npx shadcn-svelte@latest add label
npx shadcn-svelte@latest add textarea
npx shadcn-svelte@latest add select
npx shadcn-svelte@latest add dialog
npx shadcn-svelte@latest add dropdown-menu
npx shadcn-svelte@latest add tooltip
npx shadcn-svelte@latest add accordion
npx shadcn-svelte@latest add avatar
npx shadcn-svelte@latest add badge
npx shadcn-svelte@latest add switch
npx shadcn-svelte@latest add tabs
npx shadcn-svelte@latest add table
npx shadcn-svelte@latest add calendar
npx shadcn-svelte@latest add popover
npx shadcn-svelte@latest add separator
npx shadcn-svelte@latest add skeleton
npx shadcn-svelte@latest add alert
npx shadcn-svelte@latest add progress
```

#### 1.3 Install Mode Watcher

shadcn-svelte uses `mode-watcher` for theme switching:

```bash
npx shadcn-svelte@latest add mode-watcher
```

This provides:
- Automatic system preference detection
- `toggleMode()` function
- `ModeWatcher` component for `+layout.svelte`

#### 1.4 Update CSS Variables

Replace `app.css` with standard shadcn CSS variables (generated by init):

```css
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 222.2 84% 4.9%;
    --card: 0 0% 100%;
    --card-foreground: 222.2 84% 4.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 222.2 84% 4.9%;
    --primary: 199 89% 48%; /* Twitter blue #1da1f2 */
    --primary-foreground: 210 40% 98%;
    --secondary: 210 40% 96.1%;
    --secondary-foreground: 222.2 47.4% 11.2%;
    --muted: 210 40% 96.1%;
    --muted-foreground: 215.4 16.3% 46.9%;
    --accent: 210 40% 96.1%;
    --accent-foreground: 222.2 47.4% 11.2%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 40% 98%;
    --border: 214.3 31.8% 91.4%;
    --input: 214.3 31.8% 91.4%;
    --ring: 199 89% 48%;
    --radius: 0.5rem;
  }

  .dark {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;
    --card: 222.2 84% 4.9%;
    --card-foreground: 210 40% 98%;
    --popover: 222.2 84% 4.9%;
    --popover-foreground: 210 40% 98%;
    --primary: 199 89% 48%;
    --primary-foreground: 222.2 47.4% 11.2%;
    --secondary: 217.2 32.6% 17.5%;
    --secondary-foreground: 210 40% 98%;
    --muted: 217.2 32.6% 17.5%;
    --muted-foreground: 215 20.2% 65.1%;
    --accent: 217.2 32.6% 17.5%;
    --accent-foreground: 210 40% 98%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;
    --border: 217.2 32.6% 17.5%;
    --input: 217.2 32.6% 17.5%;
    --ring: 199 89% 48%;
  }
}
```

**Note:** The `lightsout` theme is removed. Users get standard light/dark modes.

---

### Phase 2: Core Components (Day 2)

#### 2.1 Replace Existing UI Components

| Current File | Action |
|--------------|--------|
| `ui/Button.svelte` | Replace with shadcn `Button` |
| `ui/Table.svelte` | Replace with shadcn `Table` |

#### 2.2 Migrate Layout Components

| Component | Changes Required |
|-----------|------------------|
| `Sidebar.svelte` | Remove `hs-accordion-group`, use shadcn `Accordion` |
| `Header.svelte` | Replace dropdown with shadcn `DropdownMenu` |
| `MobileNavbar.svelte` | Replace with shadcn `Sheet` for mobile menu |
| `ThemeToggle.svelte` | Replace with shadcn `mode-watcher` toggle |

#### 2.3 Migrate Form Components

| Component | Changes Required |
|-----------|------------------|
| `TweetCreate.svelte` | Replace inputs with shadcn `Input`, `Textarea` |
| `DateTimePicker.svelte` | Use shadcn `Calendar` + `Popover` |
| `AccountDropdown.svelte` | Use shadcn `Select` |
| `FileUpload.svelte` | Keep custom (no Preline JS dependency) |

---

### Phase 3: Page Migrations (Day 3)

#### 3.1 Remove HSStaticMethods Calls

Remove from all 13 pages:
```javascript
// DELETE THIS PATTERN
onMount(() => {
  if (browser) {
    const initPreline = () => {
      if (typeof window !== 'undefined' && window.HSStaticMethods) {
        window.HSStaticMethods.autoInit();
      }
    };
    setTimeout(initPreline, 100);
    setTimeout(initPreline, 500);
    setTimeout(initPreline, 1000);
  }
});
```

**Files to update:**
- `+layout.svelte`
- `+page.svelte` (dashboard)
- `accounts/+page.svelte`
- `admin/settings/+page.svelte`
- `admin/settings/tweet-data/+page.svelte`
- `drafts/+page.svelte`
- `gallery/+page.svelte`
- `history/+page.svelte`
- `login/+page.svelte`
- `post/+page.svelte`
- `scheduled/+page.svelte`
- `thread/+page.svelte`
- `TweetCreate.svelte`

#### 3.2 Migrate Modals/Dialogs

| Page | Current | New |
|------|---------|-----|
| `scheduled/+page.svelte` | `hs-overlay` | shadcn `Dialog` |
| `AppFormModal.svelte` | Custom modal | shadcn `Dialog` |
| `gallery/+page.svelte` | Custom modal | shadcn `Dialog` |

#### 3.3 Migrate Tooltips

| Component | Current | New |
|-----------|---------|-----|
| `PerformanceTrends.svelte` | `hs-tooltip` | shadcn `Tooltip` |

---

### Phase 4: Dashboard Components (Day 4)

#### 4.1 Overview Tab Components

| Component | Changes |
|-----------|---------|
| `OverviewTab.svelte` | Update card styles to shadcn `Card` |
| `ActivitySummary.svelte` | Use shadcn `Card`, `Badge` |
| `ContentMixChart.svelte` | Keep ApexCharts, update container styles |
| `EngagementSnapshot.svelte` | Use shadcn `Card` |
| `PerformanceTrends.svelte` | Replace tooltips, update cards |
| `SmartInsights.svelte` | Use shadcn `Card`, `Badge` |

#### 4.2 Other Dashboard Components

| Component | Changes |
|-----------|---------|
| `StatsOverview.svelte` | Use shadcn `Card` |
| `QuickActions.svelte` | Use shadcn `Button`, `Card` |
| `RecentActivity.svelte` | Use shadcn `Card`, `Avatar`, `Badge` |
| `TwitterAppsTable.svelte` | Use shadcn `Table` |

---

### Phase 5: Cleanup (Day 5)

#### 5.1 Remove Preline

```bash
npm uninstall preline
```

#### 5.2 Update Configuration Files

**app.html:**
```html
<!-- REMOVE -->
<link rel="stylesheet" href="%sveltekit.assets%/preline.css" />
<script src="/preline.js"></script>
```

**tailwind.config.js:**
```javascript
// REMOVE from content array
'./node_modules/preline/dist/*.js'
```

**app.d.ts:**
```typescript
// REMOVE Preline type declarations
interface Window {
  HSStaticMethods: { ... };
  HSThemeSwitch: { ... };
  HSFileUpload: { ... };
}
```

#### 5.3 Clean Up CSS

Remove from `app.css`:
- `@import '../../../node_modules/preline/variants.css';`
- All `.hs-*` class overrides (~200 lines)
- Preline-specific theme overrides

#### 5.4 Delete Static Assets

```bash
rm static/preline.css
rm static/preline.js
```

---

## Component Mapping Reference

### Buttons

**Before (Preline/Custom):**
```svelte
<button class="btn btn-primary">Click</button>
```

**After (shadcn):**
```svelte
<script>
  import { Button } from '$lib/components/ui/button';
</script>
<Button>Click</Button>
<Button variant="destructive">Delete</Button>
<Button variant="outline">Cancel</Button>
<Button variant="ghost">Menu</Button>
```

### Cards

**Before:**
```svelte
<div class="card">
  <div class="card-body">Content</div>
</div>
```

**After:**
```svelte
<script>
  import * as Card from '$lib/components/ui/card';
</script>
<Card.Root>
  <Card.Header>
    <Card.Title>Title</Card.Title>
    <Card.Description>Description</Card.Description>
  </Card.Header>
  <Card.Content>Content</Card.Content>
  <Card.Footer>Footer</Card.Footer>
</Card.Root>
```

### Dialogs/Modals

**Before:**
```svelte
<div id="modal" class="hs-overlay hidden">
  <div class="hs-overlay-open:opacity-100">
    <!-- content -->
  </div>
</div>
<button data-hs-overlay="#modal">Open</button>
```

**After:**
```svelte
<script>
  import * as Dialog from '$lib/components/ui/dialog';
  let open = false;
</script>
<Dialog.Root bind:open>
  <Dialog.Trigger asChild let:builder>
    <Button builders={[builder]}>Open</Button>
  </Dialog.Trigger>
  <Dialog.Content>
    <Dialog.Header>
      <Dialog.Title>Title</Dialog.Title>
      <Dialog.Description>Description</Dialog.Description>
    </Dialog.Header>
    <!-- content -->
    <Dialog.Footer>
      <Button on:click={() => open = false}>Close</Button>
    </Dialog.Footer>
  </Dialog.Content>
</Dialog.Root>
```

### Tooltips

**Before:**
```svelte
<div class="hs-tooltip inline-block">
  <button class="hs-tooltip-toggle">Hover</button>
  <span class="hs-tooltip-content">Tooltip text</span>
</div>
```

**After:**
```svelte
<script>
  import * as Tooltip from '$lib/components/ui/tooltip';
</script>
<Tooltip.Root>
  <Tooltip.Trigger>Hover</Tooltip.Trigger>
  <Tooltip.Content>
    <p>Tooltip text</p>
  </Tooltip.Content>
</Tooltip.Root>
```

### Dropdowns

**Before:**
```svelte
<div class="hs-dropdown">
  <button class="hs-dropdown-toggle">Menu</button>
  <div class="hs-dropdown-menu">
    <a href="#">Item 1</a>
  </div>
</div>
```

**After:**
```svelte
<script>
  import * as DropdownMenu from '$lib/components/ui/dropdown-menu';
</script>
<DropdownMenu.Root>
  <DropdownMenu.Trigger asChild let:builder>
    <Button builders={[builder]}>Menu</Button>
  </DropdownMenu.Trigger>
  <DropdownMenu.Content>
    <DropdownMenu.Item>Item 1</DropdownMenu.Item>
    <DropdownMenu.Separator />
    <DropdownMenu.Item>Item 2</DropdownMenu.Item>
  </DropdownMenu.Content>
</DropdownMenu.Root>
```

### Form Inputs

**Before:**
```svelte
<input class="input" type="text" />
<textarea class="textarea"></textarea>
```

**After:**
```svelte
<script>
  import { Input } from '$lib/components/ui/input';
  import { Textarea } from '$lib/components/ui/textarea';
  import { Label } from '$lib/components/ui/label';
</script>
<div class="space-y-2">
  <Label for="name">Name</Label>
  <Input id="name" placeholder="Enter name" />
</div>
<div class="space-y-2">
  <Label for="bio">Bio</Label>
  <Textarea id="bio" placeholder="Enter bio" />
</div>
```

---

## Risk Mitigation

### High-Risk Areas

1. **Theme System Simplification**
   - Remove all `lightsout` and `theme-lightsout` references
   - Remove all `data-theme` attributes (shadcn uses `.dark` class)
   - Delete ~800 lines of custom theme CSS

2. **FileUpload Component**
   - Uses custom drag-drop logic
   - Keep existing implementation, only update styling

3. **ApexCharts Integration**
   - Charts must work with new theme variables
   - Test dark mode chart rendering

4. **Mobile Navigation**
   - Current mobile nav is custom
   - Consider shadcn `Sheet` for mobile menu

### Testing Checklist

- [ ] Light mode renders correctly
- [ ] Dark mode renders correctly
- [ ] System preference detection works
- [ ] Forms submit properly
- [ ] Modals open/close correctly
- [ ] Tooltips appear on hover
- [ ] Dropdowns work on mobile
- [ ] Charts render in both themes
- [ ] File upload works
- [ ] Calendar/date picker works
- [ ] Keyboard navigation works
- [ ] Screen reader compatibility

---

## Rollback Plan

If migration fails:

1. Git revert to pre-migration commit
2. Reinstall Preline: `npm install preline`
3. Restore static assets from backup
4. Revert tailwind.config.js changes

---

## Post-Migration Benefits

| Benefit | Description |
|---------|-------------|
| **No JS initialization** | Components are self-contained Svelte |
| **Better TypeScript** | Full type safety with component props |
| **Accessibility** | Radix UI primitives are WCAG compliant |
| **Smaller bundle** | Tree-shakeable, only import what you use |
| **Active community** | Regular updates and new components |
| **Consistent API** | All components follow same patterns |

---

## File Change Summary

### Files to Create
- `$lib/components/ui/*.svelte` (shadcn components)
- `$lib/utils.ts` (shadcn utilities)

### Files to Modify
- `app.css` - Replace 1200+ lines with ~60 lines of shadcn CSS variables
- `app.html` - Remove Preline script/css
- `app.d.ts` - Remove Preline types
- `tailwind.config.js` - Remove Preline, add shadcn
- `+layout.svelte` - Remove HSStaticMethods, add `ModeWatcher`
- `ThemeToggle.svelte` - Simplify to 2-theme toggle using `mode-watcher`
- All 38 component files in `$lib/components/`
- All 17 page files in `routes/`

### Files to Delete
- `static/preline.css`
- `static/preline.js`
- `static/lodash.min.js` (if only used by Preline)

### Code to Remove (Theme Simplification)
- All `theme-lightsout:*` Tailwind classes
- All `data-theme` attribute handling
- All `[data-theme="lightsout"]` CSS selectors
- Cookie-based theme persistence (mode-watcher handles this)

---

## Recommended Approach

**Option A: Big Bang (2-3 days)**
- Migrate everything at once
- Lower risk now with simplified theme system
- Best for: Small team, can freeze features

**Option B: Gradual (1-2 weeks)**
- Run shadcn alongside Preline
- Migrate component by component
- Lowest risk, longer timeline
- Best for: Active development, can't freeze

**Recommendation:** Option A. With the simplified light/dark theme system, the migration is straightforward. The codebase is small enough for a complete migration in a focused sprint.

---

## Next Steps

1. [ ] Create feature branch: `git checkout -b feat/shadcn-migration`
2. [ ] Run `npx shadcn-svelte@latest init`
3. [ ] Install core components (button, card, dialog, etc.)
4. [ ] Add `ModeWatcher` to `+layout.svelte`
5. [ ] Replace `app.css` with shadcn CSS variables
6. [ ] Migrate Button and Card first (most used)
7. [ ] Remove all `theme-lightsout` references
8. [ ] Continue with remaining components
9. [ ] Remove Preline dependencies
10. [ ] Full regression test
11. [ ] Merge to main
